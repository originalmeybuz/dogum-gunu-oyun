<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Birthday FPS</title>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: black;
  touch-action: none;
}

/* Joystick */
#joystick {
  position: absolute;
  left: 20px;
  bottom: 20px;
  width: 120px;
  height: 120px;
  border: 2px solid #888;
  background: rgba(200,200,200,0.15);
  border-radius: 50%;
}

#stick {
  position: absolute;
  left: 45px;
  top: 45px;
  width: 30px;
  height: 30px;
  background: #aaa;
  border-radius: 50%;
}

/* Hediye Butonu */
#giftBtn {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  padding: 16px 30px;
  background: black;
  color: white;
  border: 2px solid white;
  font-family: monospace;
  font-size: 18px;
  opacity: 0;
  pointer-events: none;
  z-index: 10;
}
</style>
</head>

<body>

<div id="joystick"><div id="stick"></div></div>
<button id="giftBtn">HEDİYEYİ AÇ</button>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>

<script>
let scene, camera, renderer;
let yaw = 0, pitch = 0;
let moveX = 0, moveZ = 0;
let cake;
let giftBtn;
const speed = 0.05;

/* === KENAR ÇİZGİSİ === */
function addEdges(mesh) {
  const edges = new THREE.EdgesGeometry(mesh.geometry);
  const line = new THREE.LineSegments(
    edges,
    new THREE.LineBasicMaterial({ color: 0x000000 })
  );
  mesh.add(line);
}

init();
animate();

function init() {
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x000000);

  camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
  camera.position.set(0, 1.6, 6);

  renderer = new THREE.WebGLRenderer({ antialias:false });
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  giftBtn = document.getElementById("giftBtn");

  giftBtn.onclick = () => {
    window.open("https://originalmeybuz.github.io/dogum-gunun-kutlu-olsun-nisa/", "_blank");
  };

  /* Işık */
  const light = new THREE.PointLight(0xffffff, 1);
  light.position.set(0, 10, 0);
  scene.add(light);

  /* Zemin */
  const floor = new THREE.Mesh(
    new THREE.PlaneGeometry(20,20),
    new THREE.MeshBasicMaterial({ color: 0xffffff })
  );
  floor.rotation.x = -Math.PI/2;
  scene.add(floor);
  addEdges(floor);

  /* Tavan */
  const ceiling = new THREE.Mesh(
    new THREE.PlaneGeometry(20,20),
    new THREE.MeshBasicMaterial({ color: 0x000000 })
  );
  ceiling.position.y = 6;
  ceiling.rotation.x = Math.PI/2;
  scene.add(ceiling);

  /* ODA */
  const wallMat = new THREE.MeshBasicMaterial({ color: 0xffffff });
  const roomW=20, roomD=20, roomH=6, wallT=0.5;

  const backWall = new THREE.Mesh(new THREE.BoxGeometry(roomW,roomH,wallT),wallMat);
  backWall.position.set(0,roomH/2,-roomD/2);
  scene.add(backWall); addEdges(backWall);

  const frontWall = new THREE.Mesh(new THREE.BoxGeometry(roomW,roomH,wallT),wallMat);
  frontWall.position.set(0,roomH/2,roomD/2);
  scene.add(frontWall); addEdges(frontWall);

  const leftWall = new THREE.Mesh(new THREE.BoxGeometry(wallT,roomH,roomD),wallMat);
  leftWall.position.set(-roomW/2,roomH/2,0);
  scene.add(leftWall); addEdges(leftWall);

  const rightWall = new THREE.Mesh(new THREE.BoxGeometry(wallT,roomH,roomD),wallMat);
  rightWall.position.set(roomW/2,roomH/2,0);
  scene.add(rightWall); addEdges(rightWall);

  /* Masa */
  const table = new THREE.Mesh(
    new THREE.BoxGeometry(2,1,2),
    new THREE.MeshBasicMaterial({ color: 0x000000 })
  );
  table.position.set(0,0.5,0);
  scene.add(table); addEdges(table);

  /* Pasta */
  cake = new THREE.Mesh(
    new THREE.CylinderGeometry(0.6,0.6,0.4,16),
    new THREE.MeshBasicMaterial({ color: 0xffffff })
  );
  cake.position.set(0,1.2,0);
  scene.add(cake); addEdges(cake);

  setupTouchLook();
  setupJoystick();
  window.addEventListener("resize", onResize);
}

/* === TOUCH LOOK === */
function setupTouchLook() {
  let lastX, lastY;
  document.addEventListener("touchstart", e => {
    lastX = e.touches[0].clientX;
    lastY = e.touches[0].clientY;
  });
  document.addEventListener("touchmove", e => {
    let dx = e.touches[0].clientX - lastX;
    let dy = e.touches[0].clientY - lastY;
    yaw -= dx * 0.002;
    pitch -= dy * 0.002;
    pitch = Math.max(-Math.PI/2, Math.min(Math.PI/2, pitch));
    lastX = e.touches[0].clientX;
    lastY = e.touches[0].clientY;
  });
}

/* === JOYSTICK === */
function setupJoystick() {
  const stick = document.getElementById("stick");
  const base = document.getElementById("joystick");
  const radius = 40;

  base.addEventListener("touchmove", e => {
    e.preventDefault();
    const rect = base.getBoundingClientRect();
    const x = e.touches[0].clientX - rect.left - 60;
    const y = e.touches[0].clientY - rect.top - 60;
    const dist = Math.min(radius, Math.hypot(x,y));
    const angle = Math.atan2(y,x);
    stick.style.left = 45 + Math.cos(angle)*dist + "px";
    stick.style.top  = 45 + Math.sin(angle)*dist + "px";
    moveX = Math.cos(angle) * dist / radius;
    moveZ = Math.sin(angle) * dist / radius;
  });

  base.addEventListener("touchend", () => {
    stick.style.left="45px"; stick.style.top="45px";
    moveX = moveZ = 0;
  });
}

/* === ANIMATE === */
function animate() {
  requestAnimationFrame(animate);

  camera.rotation.order = "YXZ";
  camera.rotation.y = yaw;
  camera.rotation.x = pitch;

  camera.position.x += Math.sin(yaw)*moveZ*speed;
  camera.position.z += Math.cos(yaw)*moveZ*speed;
  camera.position.x += Math.cos(yaw)*moveX*speed;
  camera.position.z -= Math.sin(yaw)*moveX*speed;

  const dist = camera.position.distanceTo(cake.position);
  if (dist < 2) {
    giftBtn.style.opacity = "1";
    giftBtn.style.pointerEvents = "auto";
  } else {
    giftBtn.style.opacity = "0";
    giftBtn.style.pointerEvents = "none";
  }

  renderer.render(scene, camera);
}

function onResize() {
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
}
</script>

</body>
</html>
