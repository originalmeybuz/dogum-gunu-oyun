<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Birthday FPS Mobile</title>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: black;
  touch-action: none;
}

#hint {
  position: absolute;
  bottom: 20px;
  width: 100%;
  text-align: center;
  color: white;
  font-family: monospace;
  opacity: 0.6;
}

#joystick {
  position: absolute;
  left: 20px;
  bottom: 20px;
  width: 120px;
  height: 120px;
  border: 2px solid white;
  border-radius: 50%;
}

#stick {
  position: absolute;
  left: 45px;
  top: 45px;
  width: 30px;
  height: 30px;
  background: white;
  border-radius: 50%;
}
</style>
</head>

<body>

<div id="hint">PARMAĞINI KAYDIR → BAK</div>

<div id="joystick">
  <div id="stick"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>

<script>
let scene, camera, renderer;
let yaw = 0, pitch = 0;
let moveX = 0, moveZ = 0;

init();
animate();

function init() {
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x000000);

  camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
  camera.position.set(0, 1.6, 5);

  renderer = new THREE.WebGLRenderer({antialias:false});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  const light = new THREE.PointLight(0xffffff, 1);
  light.position.set(0, 10, 0);
  scene.add(light);

  const floor = new THREE.Mesh(
    new THREE.PlaneGeometry(20,20),
    new THREE.MeshBasicMaterial({color:0xffffff})
  );
  floor.rotation.x = -Math.PI/2;
  scene.add(floor);

  window.addEventListener("resize", onResize);
  setupTouchLook();
  setupJoystick();
}

function setupTouchLook() {
  let lastX, lastY;

  document.addEventListener("touchstart", e => {
    lastX = e.touches[0].clientX;
    lastY = e.touches[0].clientY;
  });

  document.addEventListener("touchmove", e => {
    const dx = e.touches[0].clientX - lastX;
    const dy = e.touches[0].clientY - lastY;

    yaw -= dx * 0.002;
    pitch -= dy * 0.002;
    pitch = Math.max(-Math.PI/2, Math.min(Math.PI/2, pitch));

    lastX = e.touches[0].clientX;
    lastY = e.touches[0].clientY;
  });
}

function setupJoystick() {
  const stick = document.getElementById("stick");
  const base = document.getElementById("joystick");
  const radius = 40;

  base.addEventListener("touchmove", e => {
    const rect = base.getBoundingClientRect();
    const x = e.touches[0].clientX - rect.left - 60;
    const y = e.touches[0].clientY - rect.top - 60;

    const dist = Math.min(radius, Math.hypot(x,y));
    const angle = Math.atan2(y,x);

    stick.style.left = 45 + Math.cos(angle)*dist + "px";
    stick.style.top  = 45 + Math.sin(angle)*dist + "px";

    moveX = Math.cos(angle) * dist / radius;
    moveZ = Math.sin(angle) * dist / radius;
  });

  base.addEventListener("touchend", () => {
    stick.style.left = "45px";
    stick.style.top = "45px";
    moveX = moveZ = 0;
  });
}

function animate() {
  requestAnimationFrame(animate);

  camera.rotation.order = "YXZ";
  camera.rotation.y = yaw;
  camera.rotation.x = pitch;

  const speed = 0.05;
  camera.position.x += Math.sin(yaw) * moveZ * speed;
  camera.position.z += Math.cos(yaw) * moveZ * speed;
  camera.position.x += Math.cos(yaw) * moveX * speed;
  camera.position.z -= Math.sin(yaw) * moveX * speed;

  renderer.render(scene, camera);
}

function onResize() {
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
}
</script>

</body>
</html>
